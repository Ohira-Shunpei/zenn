---
title: "git diff ã‚’ç”¨ã„ã¦go testã®å·®åˆ†å®Ÿè¡Œã‚’ã™ã‚‹æ–¹æ³•"
emoji: "ğŸ™†"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: [go, test]
published: false
---

## èƒŒæ™¯
ãƒªãƒ¢ãƒ¼ãƒˆãƒ–ãƒ©ãƒ³ãƒã«ã‚³ãƒŸãƒƒãƒˆãƒ»ãƒ—ãƒƒã‚·ãƒ¥ã™ã‚‹åº¦ã«ã€circle ciã‚’ç”¨ã„ã¦go testã‚’ã—ã¦ã„ã¾ã™ã€‚
å…¨ã¦ã®ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã™ã‚‹ã®ã«ç´„20åˆ†è¦ã—ã¦ã„ã¾ã—ãŸã€‚

## ã‚´ãƒ¼ãƒ«
masterãƒ–ãƒ©ãƒ³ãƒã¨ã®å·®åˆ†ãƒ•ã‚¡ã‚¤ãƒ«ã®ã¿ã‚’å–å¾—ã—ã€å·®åˆ†ãƒ•ã‚¡ã‚¤ãƒ«ãŒå«ã¾ã‚Œã‚‹ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã«å¯¾ã—ã¦ãƒ†ã‚¹ãƒˆã‚’è¡Œã„ã¾ã™ã€‚

## ã‚„ã£ã¦ã¿ãŸçµæœ
å¤‰æ›´ãƒ•ã‚¡ã‚¤ãƒ«æ•°ã«ã‚‚ä¾å­˜ã—ã¾ã™ãŒã€é€šå¸¸ã®ãƒ•ã‚¡ã‚¤ãƒ«å¤‰æ›´æ•°ã§ã‚ã‚Œã°ã€
ãƒ†ã‚¹ãƒˆå®Ÿè¡Œã«è¦ã™ã‚‹æ™‚é–“ã¯ç´„20åˆ†â†’ç´„4åˆ†ã«çŸ­ç¸®ã™ã‚‹ã“ã¨ãŒã§ãã¾ã—ãŸã€‚

## ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆ
```
MyProject/
|-- .circleci/
    |-- config.yml
|-- src/
    |-- api
        |-- controller
        |-- domain
        |-- model
        |-- repository
        |-- etc...

```

## ã‚„ã£ãŸã“ã¨
git diffã‚³ãƒãƒ³ãƒ‰ã‚’ç”¨ã„ã¦masterãƒ–ãƒ©ãƒ³ãƒã¨ã®å·®åˆ†ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å–å¾—ã—ã¾ã—ãŸã€‚
```yaml
for file in $(git diff origin/master...HEAD --name-only --diff-filter=ACMR | grep "\.go$"); do
    # ãƒ†ã‚¹ãƒˆå®Ÿè¡Œã‚³ãƒãƒ³ãƒ‰
done
```

### git diff
```
git diff ãƒ–ãƒ©ãƒ³ãƒå
```
ã§ã€ç¾åœ¨ã®ãƒ–ãƒ©ãƒ³ãƒã¨æŒ‡å®šã—ãŸãƒ–ãƒ©ãƒ³ãƒã®å·®åˆ†ã‚’å–å¾—ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

ã¾ãŸã€
```
git diff HEAD^
```
ã¨ã™ã‚‹ã“ã¨ã§ã€ç›´å‰ã®ã‚³ãƒŸãƒƒãƒˆã¨ã®å·®åˆ†ã‚’å–å¾—ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚


### --diff-fileterã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§å–å¾—ã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã‚’çµã‚Šè¾¼ã‚€
gitã®å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ(https://git-scm.com/docs/git-diff)ã«ã‚ˆã‚‹ã¨ã€
>- --diff-filter=[(A|C|D|M|R|T|U|X|B)â€¦â€‹[*]]
Select only files that are Added (A), Copied (C), Deleted (D), Modified (M), Renamed (R), have their type (i.e. regular file, symlink, submodule, â€¦â€‹) changed (T), are Unmerged (U), are Unknown (X), or have had their pairing Broken (B). Any combination of the filter characters (including none) can be used. When * (All-or-none) is added to the combination, all paths are selected if there is any file that matches other criteria in the comparison; if there is no file that matches other criteria, nothing is selected.

>Also, these upper-case letters can be downcased to exclude. E.g. --diff-filter=ad excludes added and deleted paths.
Note that not all diffs can feature all types. For instance, copied and renamed entries cannot appear if detection for those types is disabled.

è¦ã¯ã€--diff-filter=ã§æŒ‡å®šã—ãŸãƒ•ãƒ©ã‚°ã«è©²å½“ã™ã‚‹å¤‰æ›´ãƒ•ã‚¡ã‚¤ãƒ«ã®ã¿ã‚’å–å¾—ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
- --diff-filter=ACMR
    - A: ãƒ•ã‚¡ã‚¤ãƒ«ãŒæ–°ãŸã«è¿½åŠ ã•ã‚ŒãŸ
    - C: ãƒ•ã‚¡ã‚¤ãƒ«ãŒã‚³ãƒ”ãƒ¼ã•ã‚ŒãŸ
    - M: ãƒ•ã‚¡ã‚¤ãƒ«ãŒå¤‰æ›´ã•ã‚ŒãŸ
    - R: ãƒ•ã‚¡ã‚¤ãƒ«ãŒåå‰ã‚’å¤‰æ›´ã—ãŸ

å‰Šé™¤ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’go testã®å¯¾è±¡ã¨ã™ã‚‹ã¨ã€ãƒ†ã‚¹ãƒˆå®Ÿè¡Œæ™‚ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã™ã‚‹ãŸã‚ã€Dã¯å«ã‚ã¾ã›ã‚“ã§ã—ãŸã€‚
